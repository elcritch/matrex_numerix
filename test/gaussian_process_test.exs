defmodule MatrexNumerix.GP do
  use ExUnit.Case, async: true

  test "test distance iso" do

    x = Matrex.new("""
      4.854610892030431
      5.176527683588912
      4.54059036660107
      1.0556100264266548
      3.484869973967117
      4.3852256899673066
      2.2228785289423754
      0.7556418525131632
      1.9941157865846477
      3.4567590405289352
      """)

    dist_expected = Matrex.new("""
      0.0       0.321917  0.314021  3.799     1.36974    0.469385  2.63173   4.09897   2.8605    1.39785
      0.321917  0.0       0.635937  4.12092   1.69166    0.791302  2.95365   4.42089   3.18241   1.71977
      0.314021  0.635937  0.0       3.48498   1.05572    0.155365  2.31771   3.78495   2.54647   1.08383
      3.799     4.12092   3.48498   0.0       2.42926    3.32962   1.16727   0.299968  0.938506  2.40115
      1.36974   1.69166   1.05572   2.42926   0.0        0.900356  1.26199   2.72923   1.49075   0.0281109
      0.469385  0.791302  0.155365  3.32962   0.900356   0.0       2.16235   3.62958   2.39111   0.928467
      2.63173   2.95365   2.31771   1.16727   1.26199    2.16235   0.0       1.46724   0.228763  1.23388
      4.09897   4.42089   3.78495   0.299968  2.72923    3.62958   1.46724   0.0       1.23847   2.70112
      2.8605    3.18241   2.54647   0.938506  1.49075    2.39111   0.228763  1.23847   0.0       1.46264
      1.39785   1.71977   1.08383   2.40115   0.0281109  0.928467  1.23388   2.70112   1.46264   0.0
      """)

      xx = x |> Matrex.transpose()
      yy = x |> Matrex.transpose()

      dist = MatrexNumerix.Distance.diff_conv(:euclidian, xx, yy)

      assert dist |> Matrex.subtract(dist_expected) |> Matrex.sum() < 1.0e-9
  end

  test "test distance ard" do
    xx = Matrex.new("""
        4.85461  4.54059  3.48487  2.22288   1.99412  2.14055  4.9729    0.188993
        5.17653  1.05561  4.38523  0.755642  3.45676  6.1361   0.859327  3.7586
      """)

    y = Matrex.new("""
        0.05267470961035986
        -0.048384237911613726
        0.2850282970764706
        0.6186369332781118
        -0.7350901977116585
        1.2021311256811988
        -0.23481964557559754
        0.3316044775935818
      """)

    diff_expected1 = Matrex.new("""
        0.0         0.0986089   1.87619  6.92602     8.18243    7.36614      0.0139934  21.768
        0.0986089   0.0         1.11455  5.37179     6.48453    5.76021      0.186896   18.9364
        1.87619     1.11455     0.0      1.59262     2.22235    1.8072       2.21425    10.8628
        6.92602     5.37179     1.59262  0.0         0.0523324  0.00677842   7.56264     4.13669
        8.18243     6.48453     2.22235  0.0523324   0.0        0.0214422    8.87318     3.25847
        7.36614     5.76021     1.8072   0.00677842  0.0214422  0.0          8.02225     3.80857
        0.0139934   0.186896    2.21425  7.56264     8.87318    8.02225      0.0        22.8858
        21.768      18.9364     10.8628   4.13669     3.25847    3.80857     22.8858      0.0
      """)

    diff_expected1 = Matrex.new("""
          0.0       16.982       0.626159  19.5442     2.9576     0.92077  18.6382     2.01052
        16.982      0.0        11.0863     0.0899809  5.76552   25.8113    0.038527   7.30616
          0.626159  11.0863      0.0       13.1739     0.86205    3.06554  12.432      0.39266
        19.5442     0.0899809  13.1739     0.0        7.29603   28.9493    0.0107506  9.01776
          2.9576     5.76552     0.86205    7.29603    0.0        7.17884   6.74665    0.091108
          0.92077   25.8113      3.06554   28.9493     7.17884    0.0      27.8443     5.65248
        18.6382     0.038527   12.432      0.0107506  6.74665   27.8443    0.0        8.40578
          2.01052    7.30616     0.39266    9.01776    0.091108   5.65248   8.40578    0.0
      """)


  end

  test "test gp" do
    _x = """
    20] kerneldata:
      GaussianProcesses.IsotropicData{Array{Float64,2}}(
        [0.0 0.32191679155848085 0.31402052542936065 3.799000865603776 1.369740918063314 0.4693852020631244 2.6317323630880556 4.098969039517268 2.860495105445783 1.3978518515014957;
        0.32191679155848085 0.0 0.6359373169878415 4.120917657162257 1.6916577096217948 0.7913019936216052 2.9536491546465364 4.420885831075749 3.182411897004264 1.7197686430599766;
        0.31402052542936065 0.6359373169878415 0.0 3.4849803401744155 1.0557203926339533 0.15536467663376374 2.317711837658695 3.7849485140879073 2.5464745800164224 1.083831326072135;
        3.799000865603776 4.120917657162257 3.4849803401744155 0.0 2.429259947540462 3.3296156635406517 1.1672685025157206 0.2999681739134916 0.9385057601579929 2.4011490141022804;
        1.369740918063314 1.6916577096217948 1.0557203926339533 2.429259947540462 0.0 0.9003557160001896 1.2619914450247416 2.7292281214539535 1.4907541873824692 0.028110933438181718;
        0.4693852020631244 0.7913019936216052 0.15536467663376374 3.3296156635406517 0.9003557160001896 0.0 2.162347161024931 3.6295838374541436 2.3911099033826586 0.9284666494383713;
        2.6317323630880556 2.9536491546465364 2.317711837658695 1.1672685025157206 1.2619914450247416 2.162347161024931 0.0 1.4672366764292122 0.22876274235772764 1.2338805115865599;
        4.098969039517268 4.420885831075749 3.7849485140879073 0.2999681739134916 2.7292281214539535 3.6295838374541436 1.4672366764292122 0.0 1.2384739340714845 2.701117188015772;
        2.860495105445783 3.182411897004264 2.5464745800164224 0.9385057601579929 1.4907541873824692 2.3911099033826586 0.22876274235772764 1.2384739340714845 0.0 1.4626432539442875;
        1.3978518515014957 1.7197686430599766 1.083831326072135 2.4011490141022804 0.028110933438181718 0.9284666494383713 1.2338805115865599 2.701117188015772 1.4626432539442875 0.0])
    """

    _y = """
    4] cK:
      PDMats.PDMat{Float64,Array{Float64,2}}(
        10,
        [5.304795432827652e180 3.1547489851700574e180 9.27516118515065e242 4.245102153611265e175 2.4725142220995762e262 2.6568081297577577e233 1.7514059684132984e190 5.819568189232944e175 3.9239432075044596e257 8.9110159225246e252;
          5.044995590593579e223 2.1910922044010283e156 6.013346348718144e-154 3.94153469562454e180 2.1999303303064164e-152 3.292174206169816e180 2.8893696905653685e-144 1.0605405176717504e-153 2.6534262007079344e180 6.196404673509363e223;
          2.6493739320441283e180 5.709514308458247e228 3.0366798664266138e-152 2.6498684920664808e180 2.1915041205159135e156 2.457034244627092e198 1.8763293204359093e-152 4.373801347078427e-109 5.981473872361791e-154 9.209563311235732e199;
          7.500489080738067e247 8.42959463155869e252 6.186207300998975e223 5.338040972508743e184 7.362088186365724e228 9.083672028953492e223 1.6749547533378485e243 1.3371698976105067e-152 2.4609067911690642e-154 5.981473871776387e-154;
          3.154749061798256e180 1.574342797949345e161 1.6881525412108995e195 4.7666007999614415e180 2.43999444215557e-152 3.251413580497906e161 5.98147545662447e-154 1.0347887889791309e-13 2.3090818218190007e251 6.08449882763625e223;
          1.2764045610838767e-152 3.988373345207464e252 7.227620495285059e159 1.6937577679176402e190 3.5480665686142817e-106 7.219079722765707e159 3.630710528447324e228 2.6569709937587522e233 1.1174639216966926e219 1.720648504146362e-139;
          4.719837080712082e164 5.955053330201363e228 3.658824714863144e233 6.189309458894431e223 1.3288399577731165e179 4.7165167920143043e257 4.1992653392130164e228 6.01347001699904e-154 3.9155961239489724e-144 1.2782800217108994e-152;
          3.5953181385826334e246 1.3849676594927723e219 1.7189801208018767e161 6.210409585354253e175 5.7095144780765064e228 3.997271709791958e252 2.92316452425474e222 1.3849730038963418e219 8.868536798745818e175 3.9042426161349068e233;
          2.6606263136900314e-260 3.0338648296024593e-152 1.485111426595818e161 3.105731843251611e169 1.348092269409281e161 4.532588101620678e217 2.1126822876121095e-110 1.6749547565049849e243 3.1108247003735447e161 5.0e-323;
          5.299780510281259e180 1.3385685828532067e-152 1.275871977306595e-152 1.0991917360014525e155 3.776906177630725e180 2.3777319392503216e267 2.0413273792636045e161 2.6487006529728696e276 2.3556501956177705e251 0.0], LinearAlgebra.Cholesky{Float64,Array{Float64,2}}([5.304795432827652e180 3.1547489851700574e180 9.27516118515065e242 4.245102153611265e175 2.4725142220995762e262 2.6568081297577577e233 1.7514059684132984e190 5.819568189232944e175 3.9239432075044596e257 8.9110159225246e252;
          5.044995590593579e223 2.1910922044010283e156 6.013346348718144e-154 3.94153469562454e180 2.1999303303064164e-152 3.292174206169816e180 2.8893696905653685e-144 1.0605405176717504e-153 2.6534262007079344e180 6.196404673509363e223;
          2.6493739320441283e180 5.709514308458247e228 3.0366798664266138e-152 2.6498684920664808e180 2.1915041205159135e156 2.457034244627092e198 1.8763293204359093e-152 4.373801347078427e-109 5.981473872361791e-154 9.209563311235732e199;
          7.500489080738067e247 8.42959463155869e252 6.186207300998975e223 5.338040972508743e184 7.362088186365724e228 9.083672028953492e223 1.6749547533378485e243 1.3371698976105067e-152 2.4609067911690642e-154 5.981473871776387e-154;
          3.154749061798256e180 1.574342797949345e161 1.6881525412108995e195 4.7666007999614415e180 2.43999444215557e-152 3.251413580497906e161 5.98147545662447e-154 1.0347887889791309e-13 2.3090818218190007e251 6.08449882763625e223;
          1.2764045610838767e-152 3.988373345207464e252 7.227620495285059e159 1.6937577679176402e190 3.5480665686142817e-106 7.219079722765707e159 3.630710528447324e228 2.6569709937587522e233 1.1174639216966926e219 1.720648504146362e-139;
          4.719837080712082e164 5.955053330201363e228 3.658824714863144e233 6.189309458894431e223 1.3288399577731165e179 4.7165167920143043e257 4.1992653392130164e228 6.01347001699904e-154 3.9155961239489724e-144 1.2782800217108994e-152;
          3.5953181385826334e246 1.3849676594927723e219 1.7189801208018767e161 6.210409585354253e175 5.7095144780765064e228 3.997271709791958e252 2.92316452425474e222 1.3849730038963418e219 8.868536798745818e175 3.9042426161349068e233;
          2.6606263136900314e-260 3.0338648296024593e-152 1.485111426595818e161 3.105731843251611e169 1.348092269409281e161 4.532588101620678e217 2.1126822876121095e-110 1.6749547565049849e243 3.1108247003735447e161 5.0e-323;
          5.299780510281259e180 1.3385685828532067e-152 1.275871977306595e-152 1.0991917360014525e155 3.776906177630725e180 2.3777319392503216e267 2.0413273792636045e161 2.6487006529728696e276 2.3556501956177705e251 2.3089097496e-314],
        'U', 0))

    """

    # assert false
  end
end
